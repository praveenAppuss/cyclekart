{% extends 'header.html' %}
{% load static %}
{% load widget_tweaks %}

{% block content %}
<div class="flex flex-col md:flex-row min-h-[100dvh] bg-white overflow-x-hidden">

    <!-- Sidebar -->
    {% include 'sidebar.html' %}

    <!-- Main Content -->
    <div class="flex-1 p-4 sm:p-6 md:p-8 flex flex-col items-center justify-start md:justify-center bg-gray-50">
        <h2 class="text-xl sm:text-2xl font-bold mb-6 text-gray-900 text-center md:text-left w-full max-w-md">Change Password</h2>

        {% if is_google_user %}
            <div class="bg-yellow-50 border border-yellow-200 text-yellow-800 p-4 sm:p-6 rounded-xl shadow-md w-full max-w-md">
                <p class="text-base sm:text-lg text-center md:text-left leading-relaxed">
                    You signed in with <strong class="text-yellow-600">Google</strong>.
                    No need to set a password for your account.
                </p>
            </div>
        {% else %}
            <div class="bg-white p-4 sm:p-6 rounded-xl shadow-md w-full max-w-md">
                <form method="post" class="space-y-4">
                    {% csrf_token %}
                    {{ form.non_field_errors }}

                    <!-- Current Password -->
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-gray-700">Current Password</label>
                        {% render_field form.old_password class="w-full px-3 py-2 text-sm border rounded-md bg-gray-50 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500" %}
                        {% if form.old_password.errors %}
                            <span class="text-red-600 text-xs">{{ form.old_password.errors|join:", " }}</span>
                        {% endif %}
                    </div>

                    <!-- New Password -->
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-gray-700">New Password</label>
                        {% render_field form.new_password1 class="w-full px-3 py-2 text-sm border rounded-md bg-gray-50 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500" %}
                        {% if form.new_password1.errors %}
                            <span class="text-red-600 text-xs">{{ form.new_password1.errors|join:", " }}</span>
                        {% endif %}
                    </div>

                    <!-- Confirm Password -->
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-gray-700">Confirm New Password</label>
                        {% render_field form.new_password2 class="w-full px-3 py-2 text-sm border rounded-md bg-gray-50 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500" %}
                        {% if form.new_password2.errors %}
                            <span class="text-red-600 text-xs">{{ form.new_password2.errors|join:", " }}</span>
                        {% endif %}
                    </div>

                    <button type="submit"
                            class="w-full bg-gray-800 text-white py-3 rounded-lg hover:bg-gray-900 transition duration-300 shadow-md text-sm sm:text-base">
                        Update Password
                    </button>
                </form>
            </div>
        {% endif %}
    </div>
</div>

<!-- SweetAlert2 CDN -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        {% if messages %}
            {% for message in messages %}
                Swal.fire({
                    toast: true,
                    position: 'top-end',
                    icon: "{{ message.tags|default:'info' }}",
                    title: "{{ message|escapejs }}",   
                    showConfirmButton: false,
                    timer: 3000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer);
                        toast.addEventListener('mouseleave', Swal.resumeTimer);
                    }
                });
            {% endfor %}
        {% endif %}
    });
</script>
{% endblock %}
